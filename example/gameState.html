<!DOCTYPE html>
<html>

<head>
    <script src="../events.js"></script>

    <script>
        /*  @Doc
            const game controls the game through changes of the game's state with reactive programming
            Created through an anonymous self-invoking function to use the function's closure.
            Self-invoking so that it is a singleton.
        
            
            @Defn  Variable definitions in this scope
            states:
                - Contains all the possible states of the game
            currentState:
                - Variable that keeps track of the current state of the game.

            @ Use case specification:
            user should be able to :
            - (Done) read the current state
            - set a new state
            - add a event handler for a change of state.
            - ? remove a event handler previously added
        */
        const print = console.log;

        // State control / Reactive Controller in the MVC architects
        const Game = (function () {
            // const states = ["trainingModel", "gamePlay", "gameOver"];

            // This should be built on top of the eventbus system, instead of creating the this,
            // at the start of the event bus creation, it should create an object that is exactly like this, so
            // states will just be
            // const states = eventBus.events

            const states = {
                trainingModel: "trainingModel",
                gamePlay: "gamePlay",
                gameOver: "gameOver"
            };

            // Get keys of states object as String array to use it to create a Event Bus
            const eventBus = EventBus(Object.keys(states));

            // The game starts with a undefined state.
            let currentState;

            // Set method is essentially a function wrapping over the original fire method from eventBus
            // Setter method to set the value of the current state.
            function set(state) {
                // Exit method, if the game state is invalid
                if (!states[state])
                    return false;

                // If gameState is valid, update state
                currentState = state;

                eventBus.fire(eventBus.events[state]);

                // Return true to indicate operation success while ending function
                return true;
            }

            // Return the gameState object
            return Object.freeze({
                getState: () => currentState,
                set,
                states,
                // Below are abbrevations / shorthand methods for attaching event handlers
                onTraining: eventBus.on.trainingModel,
                onGamePlay: eventBus.on.gamePlay,
                onGameOver: eventBus.on.gameOver
            });
        })();

        Game.onTraining(() => print("on training callback by onTraining"))

        Game.set(Game.states.trainingModel);

    </script>
</head>

<body>
    <h1>Game Controller Test</h1>
</body>

</html>